datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// Utilisateurs (Clients)
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  firstName     String?
  lastName      String?
  phone         String?
  address       String?
  postalCode    String?
  city          String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  appointments  Appointment[]
  documents     Document[]
  magicLinks    MagicLink[]

  @@map("users")
}

// Magic Links pour authentification sans mot de passe
model MagicLink {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime @default(now())

  @@index([token])
  @@index([userId])
  @@map("magic_links")
}

// Types de services
enum ServiceType {
  INSTALLATION
  ENTRETIEN
  DEPANNAGE
}

// Statuts de rendez-vous
enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

// Rendez-vous
model Appointment {
  id              String            @id @default(cuid())
  userId          String
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  serviceType     ServiceType
  description     String?
  appointmentDate DateTime
  duration        Int               @default(120) // en minutes
  status          AppointmentStatus @default(PENDING)
  postalCode      String
  address         String
  city            String
  notes           String?
  
  // Synchronisation calendrier
  googleEventId   String?
  outlookEventId  String?
  
  // Notifications
  reminderSentAt  DateTime?
  
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@index([userId])
  @@index([appointmentDate])
  @@index([status])
  @@map("appointments")
}

// Types de documents
enum DocumentType {
  FACTURE
  DEVIS
  ATTESTATION_ENTRETIEN
  RAPPORT_INTERVENTION
  GARANTIE
}

// Documents clients
model Document {
  id          String       @id @default(cuid())
  userId      String
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  type        DocumentType
  title       String
  description String?
  fileName    String
  filePath    String
  fileSize    Int
  mimeType    String
  year        Int?
  uploadedBy  String       // Admin qui a uploadé
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([userId])
  @@index([type])
  @@index([year])
  @@map("documents")
}

// Configuration des créneaux disponibles
model AvailabilitySlot {
  id          String   @id @default(cuid())
  dayOfWeek   Int      // 0 = Dimanche, 1 = Lundi, etc.
  startTime   String   // Format HH:mm
  endTime     String   // Format HH:mm
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("availability_slots")
}

// Jours bloqués / congés
model BlockedDate {
  id          String   @id @default(cuid())
  date        DateTime
  reason      String?
  createdAt   DateTime @default(now())

  @@unique([date])
  @@map("blocked_dates")
}

// Configuration du système
model SystemConfig {
  id    String @id @default(cuid())
  key   String @unique
  value String
  
  @@map("system_config")
}
